{$SITE_DOMAIN}, www.{$SITE_DOMAIN} {
  encode zstd gzip

  # Frontend estático servido pelo Nginx interno
  route {
    @api path /api/*
    handle @api {
      reverse_proxy api:3001
    }

    # Demais rotas vão para o Nginx que serve a SPA
    handle {
      reverse_proxy web:80
    }
  }

  # Redireciona www -> apex para URL canônica
  @www host www.{$SITE_DOMAIN}
  redir @www https://{$SITE_DOMAIN}{uri} permanent

  tls pedro.techfinance@gmail.com
}
